<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
         <title>XeetFlow - Crypto Twitter Analytics Platform v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="gist-api.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            800: '#1f2937',
                            900: '#111827'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-indigo-600 rounded-lg flex items-center justify-center">
                        <span class="text-2xl font-bold text-white">XF</span>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-indigo-400">XeetFlow</h1>
                        <p class="text-sm text-gray-400">Crypto Twitter Analytics Platform</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1">
        <div class="container mx-auto px-4 py-8">
            <!-- Tournament Selector -->
            <div class="mb-6">
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-lg font-semibold mb-4">Select Tournament</h2>
                    <div class="flex space-x-4">
                        <button id="leagues-btn" class="tournament-btn bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            üèÜ Leagues Tournament
                        </button>
                        <button id="signals-btn" class="tournament-btn bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            üìä Signals Tournament
                        </button>
                    </div>
                                         <p class="text-sm text-gray-400 mt-2">
                         <span id="tournament-info">Leagues: 1797 pages, ~35,940 records</span>
                     </p>
                </div>
            </div>

            <!-- Parsing Status -->
            <div id="parsing-status" class="hidden mb-6">
                <div class="bg-gray-800 rounded-lg p-4 border-l-4 border-indigo-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-indigo-400">Parsing Data...</h3>
                            <p id="parsing-progress" class="text-sm text-gray-300">Preparing to load...</p>
                        </div>
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500"></div>
                    </div>
                    <div class="mt-3">
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="progress-bar" class="bg-indigo-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <!-- Filters Panel -->
                <div class="lg:col-span-1">
                    <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                        <h2 class="text-xl font-semibold mb-6" id="filters-title">Filters (0)</h2>
                        
                                                 <!-- Update Data Button -->
                         <div class="mb-6">
                             <button id="update-data-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-4 rounded font-medium transition-colors">
                                 üîÑ Update Data from Xeet.ai
                             </button>
                             <p class="text-xs text-gray-400 mt-2 text-center">
                                 Loads fresh data from the API
                             </p>
                             
                             <!-- GitHub Connection Test -->
                             <button id="test-github-btn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded font-medium transition-colors mt-2">
                                 üîó Test GitHub Connection
                             </button>
                             <p class="text-xs text-gray-400 mt-2 text-center">
                                 Check if GitHub Gist is configured
                             </p>
                         </div>
                        
                        <!-- Data Info -->
                        <div id="data-info" class="mb-6 hidden">
                            <div class="bg-gray-700 rounded p-3">
                                <h3 class="text-sm font-medium text-green-400 mb-2">üìä Data Loaded</h3>
                                <div class="text-xs space-y-1">
                                    <div>Total Records: <span id="total-records" class="text-blue-400">0</span></div>
                                    <div>Last Updated: <span id="last-updated" class="text-yellow-400">-</span></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Search by username</label>
                            <input type="text" id="search-input" placeholder="Enter username..." class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                        </div>
                        
                        <!-- Sorting -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Sort by</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button id="sort-score" class="sort-btn bg-indigo-600 text-white px-3 py-2 rounded text-sm font-medium">
                                    Score ‚ñº
                                </button>
                                <button id="sort-followers" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                    Followers
                                </button>
                                <button id="sort-signal" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                    Signal
                                </button>
                                <button id="sort-noise" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                    Noise
                                </button>
                            </div>
                        </div>
                        
                        <!-- Score Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Score Filter</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="score-min" placeholder="Min" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <input type="number" id="score-max" placeholder="Max" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                            </div>
                        </div>
                        
                        <!-- Noise Points Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Noise Points Filter</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="noise-min" placeholder="Min" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                                <input type="number" id="noise-max" placeholder="Max" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                            </div>
                        </div>
                        
                        <!-- Reset Button -->
                        <button id="reset-filters" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded font-medium">
                            Reset Filters
                        </button>
                    </div>
                </div>
                
                                 <!-- Heroes Grid -->
                 <div class="lg:col-span-3">
                     <div id="heroes-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                         <div class="text-center text-gray-400 py-12">
                             Select a tournament and click "Update Data" to load statistics
                         </div>
                     </div>
                     
                     <!-- Pagination -->
                     <div id="pagination" class="hidden mt-8 flex justify-center items-center space-x-4">
                         <button id="prev-page" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                             ‚Üê Previous
                         </button>
                         <span id="page-info" class="text-gray-300">
                             Page 1 of 1
                         </span>
                         <button id="next-page" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed">
                             Next ‚Üí
                         </button>
                     </div>
                 </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 mt-auto">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="w-8 h-8 bg-indigo-600 rounded flex items-center justify-center">
                        <span class="text-sm font-bold text-white">XF</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-indigo-400">XeetFlow</h3>
                        <p class="text-xs text-gray-400">Crypto Twitter Analytics Platform</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="https://x.com/jokergeeme" target="_blank" class="flex items-center space-x-2 text-gray-300 hover:text-indigo-400 transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        <span class="text-sm">Dev</span>
                    </a>
                    <a href="https://x.com/xeetdotai" target="_blank" class="flex items-center space-x-2 text-gray-300 hover:text-indigo-400 transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        <span class="text-sm">Xeet</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
                 // XeetFlow v4.0 - Main application with GitHub Gist integration
        // Global variables
        let allHeroes = [];
        let displayedHeroes = [];
        let avatarsData = {};
        let currentSort = { key: 'score', order: 'desc' };
        let isParsing = false;
        let currentTournament = 'leagues';
        
        // Pagination variables
        let currentPage = 1;
        let heroesPerPage = 20;
        let totalPages = 1;
        
                 // Global API instance (using GitHub Gist)
         const globalAPI = new GistAPI();

        // API configuration for both tournaments
        const API_CONFIGS = {
            leagues: {
                baseUrl: 'https://www.xeet.ai/api/tournaments/xeet-tournament-1/leaderboard',
                totalPages: 1797,
                limit: 20,
                delay: 500,
                name: 'Leagues Tournament',
                info: 'Leagues: 1797 pages, ~35,940 records'
            },
            signals: {
                baseUrl: 'https://www.xeet.ai/api/tournaments/5ea420b7-17c1-4a9d-9501-0fcaa60387f9/leaderboard',
                totalPages: 431,
                limit: 20,
                delay: 500,
                name: 'Signals Tournament',
                info: 'Signals: 431 pages, ~8,620 records'
            }
        };

        // DOM elements
        const leaguesBtn = document.getElementById('leagues-btn');
        const signalsBtn = document.getElementById('signals-btn');
        const tournamentInfo = document.getElementById('tournament-info');
        const updateDataBtn = document.getElementById('update-data-btn');
        const parsingStatus = document.getElementById('parsing-status');
        const parsingProgress = document.getElementById('parsing-progress');
        const progressBar = document.getElementById('progress-bar');
        const dataInfo = document.getElementById('data-info');
        const totalRecords = document.getElementById('total-records');
        const lastUpdated = document.getElementById('last-updated');
        const searchInput = document.getElementById('search-input');
        const scoreMinInput = document.getElementById('score-min');
        const scoreMaxInput = document.getElementById('score-max');
        const noiseMinInput = document.getElementById('noise-min');
        const noiseMaxInput = document.getElementById('noise-max');
                 const resetButton = document.getElementById('reset-filters');
         const heroesGrid = document.getElementById('heroes-grid');
         const filtersTitle = document.getElementById('filters-title');
         const pagination = document.getElementById('pagination');
         const prevPageBtn = document.getElementById('prev-page');
         const nextPageBtn = document.getElementById('next-page');
         const pageInfo = document.getElementById('page-info');
        const sortButtons = {
            'score': document.getElementById('sort-score'),
            'followerCount': document.getElementById('sort-followers'),
            'signalScore': document.getElementById('sort-signal'),
            'noisePoints': document.getElementById('sort-noise')
        };

        // Delay function
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Tournament selection handlers
        leaguesBtn.addEventListener('click', () => switchTournament('leagues'));
        signalsBtn.addEventListener('click', () => switchTournament('signals'));

        function switchTournament(tournament) {
            currentTournament = tournament;
            updateTournamentUI();
            clearData();
        }

        function updateTournamentUI() {
            const config = API_CONFIGS[currentTournament];
            
            // Update button styles
            leaguesBtn.className = currentTournament === 'leagues' 
                ? 'tournament-btn bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium transition-colors'
                : 'tournament-btn bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors';
            
            signalsBtn.className = currentTournament === 'signals'
                ? 'tournament-btn bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium transition-colors'
                : 'tournament-btn bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors';
            
            // Update info text
            tournamentInfo.textContent = config.info;
            
            // Update button text
            updateDataBtn.textContent = `üîÑ Update ${config.name} Data`;
        }

                 function clearData() {
             allHeroes = [];
             displayedHeroes = [];
             avatarsData = {};
             currentPage = 1;
             totalPages = 1;
             dataInfo.classList.add('hidden');
             pagination.classList.add('hidden');
             heroesGrid.innerHTML = '<div class="text-center text-gray-400 py-12">Click "Update Data" to load statistics</div>';
             filtersTitle.textContent = 'Filters (0)';
         }

        // Function to fetch data from one page
        async function fetchPage(page) {
            const config = API_CONFIGS[currentTournament];
            const params = new URLSearchParams({
                page: page,
                limit: config.limit
            });

            const response = await fetch(`${config.baseUrl}?${params}`, {
                method: 'GET',
                headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
                    'Accept': 'application/json, text/plain, */*',
                    'Accept-Language': 'en-US,en;q=0.9',
                    'Accept-Encoding': 'gzip, deflate, br',
                    'Connection': 'keep-alive',
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        }

        // Function to parse all pages
        async function parseAllPages() {
            if (isParsing) return;
            
            isParsing = true;
            allHeroes = [];
            avatarsData = {};
            
            const config = API_CONFIGS[currentTournament];
            
            // Show parsing status
            parsingStatus.classList.remove('hidden');
            updateDataBtn.disabled = true;
            updateDataBtn.textContent = '‚è≥ Parsing...';
            
            try {
                let lastUpdatedTime = '';
                
                for (let page = 1; page <= config.totalPages; page++) {
                    // Update progress
                    const progress = ((page - 1) / config.totalPages) * 100;
                    progressBar.style.width = `${progress}%`;
                    parsingProgress.textContent = `Page ${page}/${config.totalPages}...`;
                    
                    try {
                        const pageData = await fetchPage(page);
                        
                        if (pageData && pageData.data && Array.isArray(pageData.data)) {
                            // Process page data
                            pageData.data.forEach(item => {
                                if (item && item.user && item.user.username) {
                                    // Main data
                                    const hero = {
                                        rank: parseInt(item.rank) || 0,
                                        username: item.user.username,
                                        followerCount: parseInt(item.user.followerCount) || 0,
                                        score: parseFloat(item.score || 0),
                                        signalScore: parseFloat(item.signalScore || 0),
                                        noisePoints: parseFloat(item.noisePoints || 0),
                                        totalEngagement: parseInt(item.totalEngagement || 0),
                                        engagementRate: parseFloat(item.engagementRate || 0),
                                        averageEngagementPerPost: parseFloat(item.averageEngagementPerPost || 0)
                                    };
                                    
                                    allHeroes.push(hero);
                                    
                                    // Avatar data
                                    if (item.user.avatar) {
                                        avatarsData[item.user.username] = {
                                            avatar: item.user.avatar,
                                            name: item.user.name || item.user.username
                                        };
                                    }
                                    
                                    // Save last updated time
                                    if (item.lastUpdated && !lastUpdatedTime) {
                                        lastUpdatedTime = item.lastUpdated;
                                    }
                                }
                            });
                        }
                        
                        // Delay between requests
                        await delay(config.delay);
                        
                    } catch (error) {
                        console.error(`Error loading page ${page}:`, error);
                        // Continue with next page
                    }
                }
                
                // Finish parsing
                progressBar.style.width = '100%';
                parsingProgress.textContent = `Loaded ${allHeroes.length} records`;
                
                // Update data info
                totalRecords.textContent = allHeroes.length.toLocaleString();
                lastUpdated.textContent = lastUpdatedTime ? new Date(lastUpdatedTime).toLocaleString('en-US') : 'Unknown';
                dataInfo.classList.remove('hidden');
                
                                 // Apply filters and sorting
                 applyFiltersAndSort();
                 
                 // Save data to localStorage and server
                 saveDataToStorage();
                 saveDataToServer();
                
            } catch (error) {
                console.error('Error during parsing:', error);
                parsingProgress.textContent = 'Error loading data';
                alert('An error occurred while loading data. Please try again.');
            } finally {
                // Hide parsing status
                setTimeout(() => {
                    parsingStatus.classList.add('hidden');
                    updateDataBtn.disabled = false;
                    updateDataBtn.textContent = `üîÑ Update ${config.name} Data`;
                }, 2000);
                
                isParsing = false;
            }
        }

                 // Function to save data to localStorage
         function saveDataToStorage() {
             try {
                 localStorage.setItem(`xeet_heroes_data_${currentTournament}`, JSON.stringify({
                     heroes: allHeroes,
                     avatars: avatarsData,
                     timestamp: Date.now(),
                     tournament: currentTournament
                 }));
             } catch (error) {
                 console.error('Error saving to localStorage:', error);
             }
         }
         
                   // Function to save data to GitHub Gist
          async function saveDataToServer() {
              try {
                  const success = await globalAPI.saveData(currentTournament, {
                      heroes: allHeroes,
                      avatars: avatarsData,
                      timestamp: Date.now()
                  });
                  
                  if (success) {
                      console.log('‚úÖ Data saved to GitHub Gist');
                      // Show success message
                      showNotification('Data saved to GitHub Gist successfully!', 'success');
                  } else {
                      console.log('‚ö†Ô∏è Failed to save to Gist, using localStorage fallback');
                      // Fallback to localStorage
                      localStorage.setItem(`xeet_shared_data_${currentTournament}`, JSON.stringify({
                          heroes: allHeroes,
                          avatars: avatarsData,
                          timestamp: Date.now(),
                          tournament: currentTournament,
                          isShared: true
                      }));
                      showNotification('Saved to local storage (Gist unavailable)', 'warning');
                  }
              } catch (error) {
                  console.error('Error saving to Gist:', error);
                  // Fallback to localStorage
                  localStorage.setItem(`xeet_shared_data_${currentTournament}`, JSON.stringify({
                      heroes: allHeroes,
                      avatars: avatarsData,
                      timestamp: Date.now(),
                      tournament: currentTournament,
                      isShared: true
                  }));
                  showNotification('Saved to local storage (Gist error)', 'error');
              }
          }

                           // Function to load data from GitHub Gist or localStorage
          async function loadDataFromStorage() {
              try {
                  // First try to load from GitHub Gist
                  const globalData = await globalAPI.loadData(currentTournament);
                  if (globalData && globalData.heroes.length > 0) {
                      allHeroes = globalData.heroes;
                      avatarsData = globalData.avatars;
                      
                      totalRecords.textContent = allHeroes.length.toLocaleString();
                      lastUpdated.textContent = globalData.lastUpdated ? new Date(globalData.lastUpdated).toLocaleString('en-US') : 'Unknown';
                      dataInfo.classList.remove('hidden');
                      applyFiltersAndSort();
                      console.log('‚úÖ Loaded data from GitHub Gist');
                      showNotification('Data loaded from GitHub Gist', 'success');
                      return;
                  }
                  
                  // Fallback to localStorage shared data
                  const sharedData = localStorage.getItem(`xeet_shared_data_${currentTournament}`);
                  if (sharedData) {
                      const data = JSON.parse(sharedData);
                      allHeroes = data.heroes || [];
                      avatarsData = data.avatars || {};
                      
                      if (allHeroes.length > 0) {
                          totalRecords.textContent = allHeroes.length.toLocaleString();
                          lastUpdated.textContent = data.timestamp ? new Date(data.timestamp).toLocaleString('en-US') : 'Unknown';
                          dataInfo.classList.remove('hidden');
                          applyFiltersAndSort();
                          console.log('‚úÖ Loaded data from localStorage');
                          showNotification('Data loaded from local storage', 'info');
                          return;
                      }
                  }
                  
                  // Final fallback to personal data
                  const saved = localStorage.getItem(`xeet_heroes_data_${currentTournament}`);
                  if (saved) {
                      const data = JSON.parse(saved);
                      allHeroes = data.heroes || [];
                      avatarsData = data.avatars || {};
                      
                      if (allHeroes.length > 0) {
                          totalRecords.textContent = allHeroes.length.toLocaleString();
                          lastUpdated.textContent = data.timestamp ? new Date(data.timestamp).toLocaleString('en-US') : 'Unknown';
                          dataInfo.classList.remove('hidden');
                          applyFiltersAndSort();
                          console.log('‚úÖ Loaded personal data');
                          showNotification('Data loaded from personal storage', 'info');
                      }
                  }
              } catch (error) {
                  console.error('Error loading data:', error);
                  showNotification('Error loading data from Gist', 'error');
              }
          }

                 // Update data button handler
         updateDataBtn.addEventListener('click', parseAllPages);
         
         // GitHub connection test button handler
         const testGithubBtn = document.getElementById('test-github-btn');
         testGithubBtn.addEventListener('click', testGitHubConnection);

        // Filter event handlers
        searchInput.addEventListener('input', applyFiltersAndSort);
        scoreMinInput.addEventListener('input', applyFiltersAndSort);
        scoreMaxInput.addEventListener('input', applyFiltersAndSort);
        noiseMinInput.addEventListener('input', applyFiltersAndSort);
        noiseMaxInput.addEventListener('input', applyFiltersAndSort);

        // Sorting handlers
        Object.keys(sortButtons).forEach(key => {
            sortButtons[key].addEventListener('click', () => {
                if (currentSort.key === key) {
                    currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.key = key;
                    currentSort.order = 'desc';
                }
                updateSortButtons();
                applyFiltersAndSort();
            });
        });

        // Reset filters handler
        resetButton.addEventListener('click', () => {
            searchInput.value = '';
            scoreMinInput.value = '';
            scoreMaxInput.value = '';
            noiseMinInput.value = '';
            noiseMaxInput.value = '';
            currentSort = { key: 'score', order: 'desc' };
            updateSortButtons();
            applyFiltersAndSort();
        });

                 // Function to apply filters and sorting
         function applyFiltersAndSort() {
             if (allHeroes.length === 0) return;
 
             let filtered = [...allHeroes];
 
             // Search filter
             const searchTerm = searchInput.value.toLowerCase();
             if (searchTerm) {
                 filtered = filtered.filter(hero => 
                     hero.username.toLowerCase().includes(searchTerm)
                 );
             }
 
             // Score filter
             const scoreMin = scoreMinInput.value ? parseFloat(scoreMinInput.value) : null;
             const scoreMax = scoreMaxInput.value ? parseFloat(scoreMaxInput.value) : null;
             
             if (scoreMin !== null) {
                 filtered = filtered.filter(hero => hero.score >= scoreMin);
             }
             if (scoreMax !== null) {
                 filtered = filtered.filter(hero => hero.score <= scoreMax);
             }
 
             // Noise Points filter
             const noiseMin = noiseMinInput.value ? parseFloat(noiseMinInput.value) : null;
             const noiseMax = noiseMaxInput.value ? parseFloat(noiseMaxInput.value) : null;
             
             if (noiseMin !== null) {
                 filtered = filtered.filter(hero => hero.noisePoints >= noiseMin);
             }
             if (noiseMax !== null) {
                 filtered = filtered.filter(hero => hero.noisePoints <= noiseMax);
             }
 
             // Sorting
             filtered.sort((a, b) => {
                 const aValue = a[currentSort.key];
                 const bValue = b[currentSort.key];
                 
                 if (currentSort.order === 'asc') {
                     return aValue - bValue;
                 } else {
                     return bValue - aValue;
                 }
             });
 
             displayedHeroes = filtered;
             currentPage = 1; // Reset to first page when filtering
             renderHeroes();
         }

        // Function to update sort buttons
        function updateSortButtons() {
            Object.keys(sortButtons).forEach(key => {
                const button = sortButtons[key];
                if (key === currentSort.key) {
                    button.className = 'sort-btn bg-indigo-600 text-white px-3 py-2 rounded text-sm font-medium';
                    const arrow = currentSort.order === 'asc' ? ' ‚ñ≤' : ' ‚ñº';
                    button.textContent = getSortButtonText(key) + arrow;
                } else {
                    button.className = 'sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium';
                    button.textContent = getSortButtonText(key);
                }
            });
        }

        // Function to get sort button text
        function getSortButtonText(key) {
            const texts = {
                'score': 'Score',
                'followerCount': 'Followers',
                'signalScore': 'Signal',
                'noisePoints': 'Noise'
            };
            return texts[key] || key;
        }

        // Function to get avatar for user
        function getAvatarForUser(username) {
            const avatarInfo = avatarsData[username];
            if (avatarInfo && avatarInfo.avatar) {
                return avatarInfo.avatar;
            }
            return null;
        }

        // Function to get name for user
        function getNameForUser(username) {
            const avatarInfo = avatarsData[username];
            if (avatarInfo && avatarInfo.name) {
                return avatarInfo.name;
            }
            return username;
        }

                 // Function to render heroes with pagination
         function renderHeroes() {
             filtersTitle.textContent = `Filters (${displayedHeroes.length})`;
             
             if (allHeroes.length === 0) {
                 heroesGrid.innerHTML = '<div class="text-center text-gray-400 py-12">Click "Update Data" to load statistics</div>';
                 pagination.classList.add('hidden');
                 return;
             }
 
             if (displayedHeroes.length === 0) {
                 heroesGrid.innerHTML = '<div class="text-center text-gray-400 py-12">No heroes found with these parameters</div>';
                 pagination.classList.add('hidden');
                 return;
             }
 
             // Calculate pagination
             totalPages = Math.ceil(displayedHeroes.length / heroesPerPage);
             const startIndex = (currentPage - 1) * heroesPerPage;
             const endIndex = startIndex + heroesPerPage;
             const pageHeroes = displayedHeroes.slice(startIndex, endIndex);
 
             // Render heroes for current page
             heroesGrid.innerHTML = pageHeroes.map(hero => {
                 const avatarUrl = getAvatarForUser(hero.username);
                 const displayName = getNameForUser(hero.username);
                 
                 return `
                     <div class="bg-gray-800 rounded-lg p-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                         <div class="text-center mb-4">
                             <div class="w-16 h-16 mx-auto mb-3 rounded-full overflow-hidden bg-gray-700 flex items-center justify-center">
                                 ${avatarUrl ? 
                                     `<img src="${avatarUrl}" alt="${hero.username}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                      <span class="text-2xl hidden">üë§</span>` :
                                     `<span class="text-2xl">üë§</span>`
                                 }
                             </div>
                             <h3 class="font-bold text-lg text-white">${hero.username}</h3>
                             ${displayName !== hero.username ? `<p class="text-sm text-gray-400 mt-1">${displayName}</p>` : ''}
                             <div class="text-indigo-400 text-xl font-bold mt-2">${hero.score.toFixed(2)}</div>
                         </div>
                         <div class="space-y-2 text-sm text-gray-300">
                             <div class="flex justify-between">
                                 <span>Signal Score:</span>
                                 <span class="text-green-400">${hero.signalScore.toFixed(2)}</span>
                             </div>
                             <div class="flex justify-between">
                                 <span>Noise Points:</span>
                                 <span class="text-red-400">${hero.noisePoints.toFixed(2)}</span>
                             </div>
                             <div class="flex justify-between">
                                 <span>Followers:</span>
                                 <span class="text-blue-400">${hero.followerCount.toLocaleString()}</span>
                             </div>
                             <div class="flex justify-between">
                                 <span>Rank:</span>
                                 <span class="text-yellow-400">#${hero.rank}</span>
                             </div>
                         </div>
                     </div>
                 `;
             }).join('');
 
             // Update pagination
             updatePagination();
         }
         
         // Function to update pagination controls
         function updatePagination() {
             if (totalPages <= 1) {
                 pagination.classList.add('hidden');
                 return;
             }
             
             pagination.classList.remove('hidden');
             pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
             
             prevPageBtn.disabled = currentPage === 1;
             nextPageBtn.disabled = currentPage === totalPages;
             
             prevPageBtn.className = currentPage === 1 
                 ? 'bg-gray-700 text-gray-500 px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed'
                 : 'bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded';
             
             nextPageBtn.className = currentPage === totalPages
                 ? 'bg-gray-700 text-gray-500 px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed'
                 : 'bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded';
         }

                 // Pagination event handlers
         prevPageBtn.addEventListener('click', () => {
             if (currentPage > 1) {
                 currentPage--;
                 renderHeroes();
             }
         });
         
         nextPageBtn.addEventListener('click', () => {
             if (currentPage < totalPages) {
                 currentPage++;
                 renderHeroes();
             }
         });
         
                   // Function to show notifications
          function showNotification(message, type = 'info') {
              // Create notification element
              const notification = document.createElement('div');
              notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm transition-all duration-300 transform translate-x-full`;
              
              // Set colors based on type
              const colors = {
                  success: 'bg-green-600 text-white',
                  error: 'bg-red-600 text-white',
                  warning: 'bg-yellow-600 text-white',
                  info: 'bg-blue-600 text-white'
              };
              
              notification.className += ` ${colors[type] || colors.info}`;
              notification.innerHTML = `
                  <div class="flex items-center">
                      <span class="mr-2">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                      <span>${message}</span>
                  </div>
              `;
              
              // Add to page
              document.body.appendChild(notification);
              
              // Animate in
              setTimeout(() => {
                  notification.classList.remove('translate-x-full');
              }, 100);
              
              // Remove after 5 seconds
              setTimeout(() => {
                  notification.classList.add('translate-x-full');
                  setTimeout(() => {
                      document.body.removeChild(notification);
                  }, 300);
              }, 5000);
          }
          
          // Function to test GitHub connection
          async function testGitHubConnection() {
              try {
                  testGithubBtn.disabled = true;
                  testGithubBtn.textContent = 'Testing...';
                  
                  const result = await globalAPI.testConnection();
                  
                  if (result.success) {
                      showNotification(`GitHub connected successfully! User: ${result.user}`, 'success');
                  } else {
                      showNotification(`GitHub connection failed: ${result.error}`, 'error');
                  }
              } catch (error) {
                  showNotification(`GitHub test error: ${error.message}`, 'error');
              } finally {
                  testGithubBtn.disabled = false;
                  testGithubBtn.textContent = 'üîó Test GitHub Connection';
              }
          }
          
          // Initialization
          updateTournamentUI();
          updateSortButtons();
          loadDataFromStorage().then(() => {
              console.log('‚úÖ Initialization complete');
          });
    </script>
</body>
</html>
