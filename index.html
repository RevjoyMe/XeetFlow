<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xeet.ai Crypto Influencers Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            800: '#1f2937',
                            900: '#111827'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-indigo-400">Xeet.ai Crypto Influencers Dashboard</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Панель фильтров -->
            <div class="lg:col-span-1">
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h2 class="text-xl font-semibold mb-6" id="filters-title">Фильтры (0)</h2>
                    
                    <!-- Загрузчик файла -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Загрузить CSV файл</label>
                        <input type="file" id="file-input" accept=".csv" class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                    </div>
                    
                    <!-- Поиск -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Поиск по username</label>
                        <input type="text" id="search-input" placeholder="Введите username..." class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                    </div>
                    
                    <!-- Сортировка -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Сортировка</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="sort-score" class="sort-btn bg-indigo-600 text-white px-3 py-2 rounded text-sm font-medium">
                                Score ▼
                            </button>
                            <button id="sort-followers" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                Followers
                            </button>
                            <button id="sort-signal" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                Signal
                            </button>
                            <button id="sort-noise" class="sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium">
                                Noise
                            </button>
                        </div>
                    </div>
                    
                    <!-- Фильтр по Score -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Фильтр по Score</label>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="score-min" placeholder="Мин" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                            <input type="number" id="score-max" placeholder="Макс" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                        </div>
                    </div>
                    
                    <!-- Фильтр по Noise Points -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">Фильтр по Noise Points</label>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="noise-min" placeholder="Мин" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                            <input type="number" id="noise-max" placeholder="Макс" class="p-2 bg-gray-700 border border-gray-600 rounded text-sm">
                        </div>
                    </div>
                    
                    <!-- Кнопка сброса -->
                    <button id="reset-filters" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded font-medium">
                        Сбросить фильтры
                    </button>
                </div>
            </div>
            
            <!-- Сетка героев -->
            <div class="lg:col-span-3">
                <div id="heroes-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
                    <div class="text-center text-gray-400 py-12">
                        Пожалуйста, загрузите CSV файл
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Глобальные переменные
        let allHeroes = [];
        let displayedHeroes = [];
        let currentSort = { key: 'score', order: 'desc' };

        // Элементы DOM
        const fileInput = document.getElementById('file-input');
        const searchInput = document.getElementById('search-input');
        const scoreMinInput = document.getElementById('score-min');
        const scoreMaxInput = document.getElementById('score-max');
        const noiseMinInput = document.getElementById('noise-min');
        const noiseMaxInput = document.getElementById('noise-max');
        const resetButton = document.getElementById('reset-filters');
        const heroesGrid = document.getElementById('heroes-grid');
        const filtersTitle = document.getElementById('filters-title');
        const sortButtons = {
            'score': document.getElementById('sort-score'),
            'followerCount': document.getElementById('sort-followers'),
            'signalScore': document.getElementById('sort-signal'),
            'noisePoints': document.getElementById('sort-noise')
        };

        // Обработчик загрузки файла
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                Papa.parse(file, {
                    header: true,
                    complete: function(results) {
                        allHeroes = results.data.map(hero => ({
                            ...hero,
                            rank: parseInt(hero.rank),
                            followerCount: parseInt(hero.followerCount),
                            score: parseFloat(hero.score),
                            signalScore: parseFloat(hero.signalScore),
                            noisePoints: parseFloat(hero.noisePoints),
                            totalEngagement: parseInt(hero.totalEngagement),
                            engagementRate: parseFloat(hero.engagementRate),
                            averageEngagementPerPost: parseFloat(hero.averageEngagementPerPost)
                        })).filter(hero => hero.username); // Убираем пустые строки
                        
                        applyFiltersAndSort();
                    },
                    error: function(error) {
                        console.error('Ошибка при парсинге CSV:', error);
                        alert('Ошибка при загрузке файла');
                    }
                });
            }
        });

        // Обработчики событий для фильтров
        searchInput.addEventListener('input', applyFiltersAndSort);
        scoreMinInput.addEventListener('input', applyFiltersAndSort);
        scoreMaxInput.addEventListener('input', applyFiltersAndSort);
        noiseMinInput.addEventListener('input', applyFiltersAndSort);
        noiseMaxInput.addEventListener('input', applyFiltersAndSort);

        // Обработчики сортировки
        Object.keys(sortButtons).forEach(key => {
            sortButtons[key].addEventListener('click', () => {
                if (currentSort.key === key) {
                    currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.key = key;
                    currentSort.order = 'desc';
                }
                updateSortButtons();
                applyFiltersAndSort();
            });
        });

        // Обработчик сброса фильтров
        resetButton.addEventListener('click', () => {
            searchInput.value = '';
            scoreMinInput.value = '';
            scoreMaxInput.value = '';
            noiseMinInput.value = '';
            noiseMaxInput.value = '';
            currentSort = { key: 'score', order: 'desc' };
            updateSortButtons();
            applyFiltersAndSort();
        });

        // Функция применения фильтров и сортировки
        function applyFiltersAndSort() {
            if (allHeroes.length === 0) return;

            let filtered = [...allHeroes];

            // Фильтр по поиску
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(hero => 
                    hero.username.toLowerCase().includes(searchTerm)
                );
            }

            // Фильтр по Score
            const scoreMin = scoreMinInput.value ? parseFloat(scoreMinInput.value) : null;
            const scoreMax = scoreMaxInput.value ? parseFloat(scoreMaxInput.value) : null;
            
            if (scoreMin !== null) {
                filtered = filtered.filter(hero => hero.score >= scoreMin);
            }
            if (scoreMax !== null) {
                filtered = filtered.filter(hero => hero.score <= scoreMax);
            }

            // Фильтр по Noise Points
            const noiseMin = noiseMinInput.value ? parseFloat(noiseMinInput.value) : null;
            const noiseMax = noiseMaxInput.value ? parseFloat(noiseMaxInput.value) : null;
            
            if (noiseMin !== null) {
                filtered = filtered.filter(hero => hero.noisePoints >= noiseMin);
            }
            if (noiseMax !== null) {
                filtered = filtered.filter(hero => hero.noisePoints <= noiseMax);
            }

            // Сортировка
            filtered.sort((a, b) => {
                const aValue = a[currentSort.key];
                const bValue = b[currentSort.key];
                
                if (currentSort.order === 'asc') {
                    return aValue - bValue;
                } else {
                    return bValue - aValue;
                }
            });

            displayedHeroes = filtered;
            renderHeroes();
        }

        // Функция обновления кнопок сортировки
        function updateSortButtons() {
            Object.keys(sortButtons).forEach(key => {
                const button = sortButtons[key];
                if (key === currentSort.key) {
                    button.className = 'sort-btn bg-indigo-600 text-white px-3 py-2 rounded text-sm font-medium';
                    const arrow = currentSort.order === 'asc' ? ' ▲' : ' ▼';
                    button.textContent = getSortButtonText(key) + arrow;
                } else {
                    button.className = 'sort-btn bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm font-medium';
                    button.textContent = getSortButtonText(key);
                }
            });
        }

        // Функция получения текста кнопки сортировки
        function getSortButtonText(key) {
            const texts = {
                'score': 'Score',
                'followerCount': 'Followers',
                'signalScore': 'Signal',
                'noisePoints': 'Noise'
            };
            return texts[key] || key;
        }

        // Функция рендеринга героев
        function renderHeroes() {
            filtersTitle.textContent = `Фильтры (${displayedHeroes.length})`;
            
            if (allHeroes.length === 0) {
                heroesGrid.innerHTML = '<div class="text-center text-gray-400 py-12">Пожалуйста, загрузите CSV файл</div>';
                return;
            }

            if (displayedHeroes.length === 0) {
                heroesGrid.innerHTML = '<div class="text-center text-gray-400 py-12">Герои с такими параметрами не найдены</div>';
                return;
            }

            heroesGrid.innerHTML = displayedHeroes.map(hero => `
                <div class="bg-gray-800 rounded-lg p-4 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                    <div class="text-center mb-4">
                        <div class="w-16 h-16 mx-auto mb-3 bg-gray-700 rounded-full flex items-center justify-center">
                            <span class="text-2xl">👤</span>
                        </div>
                        <h3 class="font-bold text-lg text-white">${hero.username}</h3>
                        <div class="text-indigo-400 text-xl font-bold mt-2">${hero.score.toFixed(2)}</div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-300">
                        <div class="flex justify-between">
                            <span>Signal Score:</span>
                            <span class="text-green-400">${hero.signalScore.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Noise Points:</span>
                            <span class="text-red-400">${hero.noisePoints.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Followers:</span>
                            <span class="text-blue-400">${hero.followerCount.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Rank:</span>
                            <span class="text-yellow-400">#${hero.rank}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Инициализация
        updateSortButtons();
    </script>
</body>
</html>
